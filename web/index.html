<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-DXX7TTGN0E"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-DXX7TTGN0E");
    </script>

    <title>What's in Standard?</title>
    <meta charset="UTF-8" />
    <meta
      name="description"
      content="A Magic: The Gathering format describer"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      rel="stylesheet"
      href="/node_modules/npm-font-open-sans/open-sans.css"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="/node_modules/keyrune/css/keyrune.min.css"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="/node_modules/bootstrap/dist/css/bootstrap.min.css"
      media="screen"
    />
    <script
      src="https://kit.fontawesome.com/2b022a4ed7.js"
      crossorigin="anonymous"
    ></script>

    <link rel="stylesheet" href="css/style.css" media="screen" />

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="manifest.json" />
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#808080" />
    <meta name="msapplication-TileColor" content="#2d89ef" />
    <meta name="theme-color" content="#ffffff" />

    <meta name="apple-itunes-app" content="app-id=1575154818" />

    <script type="importmap">
      {
        "imports": {
          "vue": "https://cdnjs.cloudflare.com/ajax/libs/vue/3.2.41/vue.esm-browser.prod.js",
          "vue-router": "https://cdnjs.cloudflare.com/ajax/libs/vue-router/4.1.5/vue-router.esm-browser.min.js"
        }
      }
    </script>
  </head>

  <body data-spy="scroll" data-target="#nav" id="sets">
    <div id="vue" class="container">
      <a class="d-inline" name="sets" id="sets"></a>
      <div class="d-flex">
        <div class="col mx-1">
          <div class="row mb-2">
            <div class="mt-3 d-flex">
              <img
                id="site-icon"
                src="icon-original.svg"
                alt="What's in Standard? logo"
                class="d-none d-sm-inline"
              />
              <div class="w-100">
                <h1>What's in Standard?</h1>
                <div class="row row-cols-1 row-cols-sm-2">
                  <div class="my-2">for Magic: The Gathering</div>
                  <div
                    class="d-xl-flex text-end justify-content-xs-center justify-content-sm-end my-2"
                  >
                    <button
                      class="btn btn-outline-dark btn-sm my-1 mx-1"
                      v-on:click.prevent="toggleRecentlyDropped"
                    >
                      <template v-if="showRecentlyDropped">
                        Hide left sets
                      </template>
                      <template v-else> What just left? </template>
                    </button>
                    <div class="dropdown">
                      <a
                        class="btn btn-outline-dark btn-sm my-1 mx-1 dropdown-toggle"
                        type="button"
                        data-bs-toggle="dropdown"
                        aria-expanded="false"
                      >
                        <img
                          class="m-1"
                          src="img/mastodon.svg"
                          alt="Mastodon logo"
                          height="20"
                          width="20"
                        />
                        <img
                          class="m-1"
                          src="img/twitter.svg"
                          alt="Twitter logo"
                          height="20"
                          width="20"
                        />
                        Follow our bot
                      </a>
                      <ul class="dropdown-menu">
                        <li>
                          <a
                            rel="me"
                            class="dropdown-item"
                            href="https://m.twos.dev/@whatsinstandard"
                          >
                            <img
                              class="m-1"
                              src="img/mastodon.svg"
                              alt="Mastodon logo"
                              height="20"
                              width="20"
                            />
                            Mastodon
                          </a>
                        </li>
                        <li>
                          <a
                            class="dropdown-item"
                            href="https://twitter.com/whatsinstandard"
                          >
                            <img
                              class="m-1"
                              src="img/twitter.svg"
                              alt="Twitter logo"
                              height="20"
                              width="20"
                            />
                            Twitter
                          </a>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div v-if="false" class="d-flex justify-content-center">
              <div class="spinner-border my-5" role="status"></div>
              <div class="visually-hidden">Fetching Standard</div>
            </div>
            <div class="row mx-0 px-0 row-cols-1 row-cols-lg-2">
              <div
                v-if="showRecentlyDropped"
                class="col mb-4 border border-danger py-3 mx-2 px-0"
                v-cloak
              >
                <span class="text-danger small mx-2">
                  Illegal as of {{
                  humanDate(last(rounds(dropped(sets)))[0].exitDate) }}
                </span>
                <div class="col list-group px-2">
                  <template v-for="set in last(rounds(dropped(sets)))">
                    <a
                      class="p-3 list-group-item text-dark d-flex justify-content-between align-items-start set-border"
                      :class="{'bg-light': isReleased(set), 'text-muted': !isReleased(set)}"
                      :href="set.code ? `https://www.scryfall.com/sets/${set.code.toLowerCase()}?utm_source=whatsinstandard` : ''"
                    >
                      <div
                        v-if="set.code"
                        :class="{'text-dark': isReleased(set), 'text-muted': !isReleased(set)}"
                      >
                        {{ set.unknown ? '???' : set.name || `"${set.codename}"`
                        }}
                      </div>
                      <div
                        class="text-dark"
                        :class="{'lead': isReleased(set), 'text-muted': !isReleased(set)}"
                        v-else
                      >
                        {{ set.unknown ? '???' : set.name || `"${set.codename}"`
                        }}
                      </div>
                      <set-image
                        :code="set.code"
                        v-if="isReleased(set)"
                      ></set-image>
                      <small
                        class="font-italic"
                        v-if="!isReleased(set)"
                        v-tippy
                        :title="humanDate(set.enterDate)"
                      >
                        releases {{ relative(dateFrom(set.enterDate)) }}
                      </small>
                    </a>
                  </template>
                </div>
              </div>
            </div>
            <div
              v-if="!hideAlert20230507"
              class="row justify-content-around px-3 mx-0"
              v-cloak
            >
              <div
                class="col-md-8 alert alert-info alert-dismissible fade show"
                role="alert"
              >
                <h4 class="alert-heading mb-3">New rules</h4>
                <p>
                  On
                  <a
                    class="alert-link"
                    href="https://magic.wizards.com/en/news/announcements/revitalizing-standard"
                    >2023-05-07</a
                  >, <i>Wizards</i> permanently lengthened sets' Standard
                  lifespans by one year, effective immediately.
                </p>
                <p>
                  Therefore no sets will drop from Standard in 2023. This
                  increases the average size of Standard from 6 ½ sets to 10 ½
                  sets.
                </p>
                <p>
                  All information below has been updated to reflect this change.
                </p>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="alert"
                  aria-label="Close"
                  @click="hideAlert20230507 = true"
                ></button>
              </div>
            </div>
            <div
              v-for="round in truncate(rounds(undropped(sets)))"
              class="row row-cols-1 row-cols-lg-2 mb-4 px-0 py-3 mx-0"
              v-cloak
            >
              <div class="col list-group px-3">
                <template v-for="set in round">
                  <a
                    class="p-3 list-group-item text-dark d-flex justify-content-between align-items-start set-border"
                    :class="{'bg-light': isReleased(set), 'text-muted': !isReleased(set)}"
                    :href="set.code ? `https://www.scryfall.com/sets/${set.code.toLowerCase()}?utm_source=whatsinstandard` : ''"
                  >
                    <span
                      v-if="set.code"
                      :class="{'text-dark': isReleased(set), 'text-muted': !isReleased(set)}"
                    >
                      {{ set.unknown ? '???' : set.name || `"${set.codename}"`
                      }}
                    </span>
                    <span
                      class="text-dark"
                      :class="{'lead': isReleased(set),
                    'text-muted': !isReleased(set)}"
                      v-else
                    >
                      {{ set.unknown ? '???' : set.name || `"${set.codename}"`
                      }}
                    </span>
                    <set-image
                      :code="set.code"
                      v-if="isReleased(set)"
                    ></set-image>
                    <small
                      class="font-italic"
                      v-if="!isReleased(set)"
                      v-tippy
                      :title="humanDate(set.enterDate)"
                    >
                      releases {{ relative(dateFrom(set.enterDate)) }}
                    </small>
                  </a>
                </template>
              </div>
              <div class="col d-none d-lg-flex align-items-center h-100">
                <div
                  class="px-1 h-100"
                  style="
                    border-width: 1px 1px 1px 0;
                    border-style: solid;
                    border-color: black;
                  "
                ></div>
                <div class="m-3 text-center">
                  Legal until {{ humanDate(round[0].exitDate) }}
                </div>
              </div>
              <div class="row d-block d-lg-none w-100 mx-0 px-2">
                <div
                  class="py-1 my-3 w-100"
                  style="
                    border-width: 0px 1px 1px 1px;
                    border-style: solid;
                    border-color: black;
                  "
                ></div>
                <div class="px-0 mx-0 my-3 text-center">
                  Legal until {{ humanDate(round[0].exitDate) }}
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6">
                <h3 class="pt-3" id="bans">Banned cards</h3>
                <template v-if="bans.length === 0">
                  <i>No cards are banned from Standard right now.</i>
                </template>
                <template v-else>
                  <p>
                    Despite being part of legal sets, the following cards are
                    explicitly not allowed in decks for this format.
                  </p>
                  <div class="row" v-cloak>
                    <div
                      v-for="ban in bansFor(undropped(sets), bans)"
                      class="col-sm-12 col-md-12 col-lg-6"
                    >
                      <div class="card mb-3">
                        <img
                          :src="ban.cardImageUrl"
                          class="card-img-top"
                          :alt="`${ban.cardName} from ${ban.setCode}`"
                        />
                        <div class="card-body">
                          <p class="card-text">{{ ban.reason }}</p>
                          <a
                            :href="`https://scryfall.com/search?q=!“${ban.cardName}” set:${ban.setCode}&utm_source=whatsinstandard`"
                            class="btn btn-outline-primary btn-sm text-uppercase my-1 me-1"
                            rel="noopener"
                          >
                            Scryfall
                          </a>
                          <a
                            :href="ban.announcementUrl"
                            class="btn btn-outline-secondary btn-sm text-uppercase my-1"
                          >
                            Announcement
                          </a>
                        </div>
                      </div>
                    </div>
                  </div>
                </template>
              </div>
              <div class="col-md-6">
                <h2 class="pt-3" id="info">What <em>is</em> Standard?</h2>
                <p>
                  <a
                    target="_blank"
                    href="https://magic.wizards.com/en/content/standard-formats-magic-gathering"
                    rel="noopener"
                  >
                    <b>Standard</b>
                  </a>
                  is a tournament format containing ~9&ndash;12 recent
                  <i>Magic: The Gathering</i> sets. Sets generally enter the
                  format when they're released and drop out 2.5&ndash;3 years
                  later in groups of four. This is a rule of thumb; exceptions
                  are frequently made. This site will always have accurate
                  information.
                </p>
                <p>
                  A <b>Standard card</b> is a card from a set currently part of
                  the legal pool.
                  <a
                    v-tippy
                    class="tip"
                    title="Different versions of a card count as the same card.<br>
                    e.g. As long as Naturalize is Standard-legal, so are all prints of that card from previous sets."
                  >
                  </a>
                </p>
                <p>
                  A <b>Standard deck</b> contains 60+ Standard cards and can
                  optionally have a sideboard
                  <a
                    v-tippy
                    class="tip"
                    title="A sideboard is a second pool of cards outside the main deck that cannot be used during games,
                  but whose cards can be swapped with or added to the main deck cards between games in a match.
                  Sideboard cards are usually situational, providing counters to specific deck archetypes."
                  >
                  </a>
                  of up to 15 additional such cards. Apart from basic lands, the
                  combined main deck and sideboard cannot have more than four
                  copies of any card.
                </p>
                <h3 class="mt-5">Related sets and formats</h3>
                <p>
                  <a
                    target="_blank"
                    href="https://magic.wizards.com/en/game-info/gameplay/formats/brawl"
                    rel="noopener"
                    ><b>Brawl</b></a
                  >
                  is a format based on Standard—all rotations listed here apply
                  to Brawl as well—but Brawl has its own banlist.
                </p>
                <p>
                  Not all sets enter Standard upon release. For example, Masters
                  sets and Commander sets never enter the format.
                </p>
                <div class="github my-4">
                  <a
                    rel="me"
                    v-tippy
                    class="btn"
                    href="https://m.twos.dev/@whatsinstandard"
                    title="See rotations in your Mastodon timeline"
                  >
                    <img
                      class="m-1"
                      src="img/mastodon.svg"
                      alt="Mastodon logo"
                      height="35"
                      width="35"
                    />
                  </a>
                  <a
                    v-tippy
                    class="btn"
                    href="https://twitter.com/whatsinstandard"
                    title="See rotations in your Twitter timeline"
                  >
                    <img
                      class="m-1"
                      src="img/twitter.svg"
                      alt="Twitter logo"
                      height="35"
                      width="35"
                    />
                  </a>
                  <a
                    v-tippy
                    class="btn"
                    href="https://github.com/glacials/whatsinstandard"
                    title="We're open source!"
                  >
                    <img
                      class="m-1"
                      src="img/github.png"
                      alt="GitHub logo"
                      height="35"
                      width="35"
                    />
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="/node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/node_modules/moment/min/moment.min.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <script src="https://unpkg.com/tippy.vue@3"></script>
    <script type="module">
      import {
        createApp,
        ref,
      } from "https://unpkg.com/vue@3/dist/vue.esm-browser.js";
      import { TippyPlugin } from "tippy.vue";
      import SetImage from "./js/SetImage.vue";

      const apiURL = "/api/v6/standard.json";

      createApp({
        components: {
          SetImage,
          TippyPlugin,
        },

        computed: {},

        created: function () {
          fetch(apiURL)
            .then((response) => response.json())
            .then((data) => {
              this.sets = data.sets;
              this.bans = data.bans;
            });

          setInterval(() => (this.now = new Date()), 1000 * 60);
        },

        data() {
          return {
            bans: [],
            now: new Date(),
            sets: [],
            showRecentlyDropped: false,
            hideAlert20230507: true,
          };
        },

        el: "#vue",

        filters: {
          absolute: (date) => moment(date).format("YYYY-MM-DD"),
          year: (date) => moment(date).format("\\QQ YYYY"),
        },

        methods: {
          // bansFor returns the bans in the given bans array that apply to the given array of
          // sets.
          bansFor: function (sets, bans) {
            return bans.filter((ban) =>
              sets.map((set) => set.code).includes(ban.setCode)
            );
          },

          // dropped returns the sets in the given array of sets that have dropped from Standard according to local time,
          // preserving order.
          dropped: function (sets) {
            return sets.filter(
              (set) => (Date.parse(set.exitDate.exact) || Infinity) <= this.now
            );
          },

          // dateFrom returns a Date object for the given set date. A set date is an object returned by the What's in
          // Standard? API that contains a rough date and an optional exact date.
          //
          // If the set date has no exact property, a less accurate Date object is still created out of its rough property.
          // Because of this you should not display the returned date directly to users, but use it for low-resolution
          // calculations, long-term relative times, and other rough display methods.
          dateFrom: function (setDate) {
            if (setDate.exact !== null) {
              return Date.parse(setDate.exact);
            }

            if (setDate.rough.match(/Q\d \d{4}/)) {
              const quarter = setDate.rough.split(" ")[0][1];
              const year = setDate.rough.split(" ")[1];

              return new Date(year, 12 - 12 / Number(quarter) + 1, 15);
            } else {
              return new Date(setDate.rough);
            }
          },

          // humanDate returns a human-friendly string expressing the given set date. A set date is an object returned by the
          // What's in Standard? API that contains a rough date and an optional exact date.
          //
          // If the set date has no exact property, a the rough exit date is shown.
          humanDate: function (setDate) {
            if (setDate.exact !== null) {
              return new Date(setDate.exact).toLocaleDateString(undefined, {
                weekday: "long",
                year: "numeric",
                month: "long",
                day: "numeric",
              });
            }

            return setDate.rough;
          },

          // isReleased returns true if the given set or round has been released according to local time, or false otherwise.
          // A round is released if and only if all its sets are released.
          isReleased: function (setOrRound) {
            if (Array.isArray(setOrRound)) {
              return this.isReleased(this.last(setOrRound));
            }

            return Date.parse(setOrRound.enterDate.exact) <= this.now;
          },

          // last returns the last element of an array.
          last: (setsOrRounds) => setsOrRounds[setsOrRounds.length - 1],

          // pad returns an array padded to the given length with the given fill value.
          pad: (array, length, fill) =>
            length > array.length
              ? array.concat(Array(length - array.length).fill(fill))
              : array,

          // padded takes an array of rounds (i.e. a two-dimensional array of sets organized by exitDate.rough) and pads the
          // each round with blank sets until it is equal to the size of the largest round.
          padded: function (rounds) {
            const padTo = Math.max(...rounds.map((round) => round.length));
            const fillerSet = { unknown: true };
            return rounds.map((round) => this.pad(round, padTo, fillerSet));
          },

          // recent returns an array containing only the last element of the given array.
          recent: (setsOrRounds) => [setsOrRounds[setsOrRounds.length - 1]],

          // relative returns a human-friendly relative time string for the given date.
          relative: function (date) {
            return moment(date).from(this.now);
          },

          // rounds splits the given array of sets into a two-dimensional array where each sub-array is a group of sets that
          // share a exitDate.rough. Orders are preserved.
          rounds: function (sets) {
            // Note that to preserve order for the outer array, the key of the interim object
            // must be a string because ES2015 object property order is preserved only for
            // string keys.
            return Object.values(
              sets.reduce((rounds, set) => {
                return Object.assign(rounds, {
                  [set.exitDate.rough]: (
                    rounds[set.exitDate.rough] || []
                  ).concat(set),
                });
              }, {})
            );
          },

          // standard returns the sets in the given array that are currently in Standard according to local time, preserving
          // order.
          standard: function (sets) {
            return sets.filter(
              (set) =>
                !this.unreleased(sets).includes(set) &&
                !this.dropped(sets).includes(set)
            );
          },

          // toggleRecentlyDropped shows or hides the recently dropped sets area of the page.
          toggleRecentlyDropped: function () {
            this.showRecentlyDropped = !this.showRecentlyDropped;
            const msg = this.showRecentlyDropped
              ? "show recently dropped sets"
              : "hide recently dropped sets";
            ga("send", "event", "link", "click", msg);
          },

          // truncate returns the sets or rounds in the given array, but limits unreleased sets or rounds to 1. Use this to
          // prevent the UI from feeling overloaded if we happen to get a bunch of new information about the next year of
          // sets.
          truncate: function (setsOrRounds) {
            var unreleasedSetsOrRounds = 0;
            return setsOrRounds.filter((setOrROund) => {
              if (!this.isReleased(setOrROund)) {
                unreleasedSetsOrRounds += 1;
              }

              return unreleasedSetsOrRounds <= 1;
            });
          },

          // undropped returns the sets in the given array of sets that have not dropped from Standard (including sets that
          // haven't even entered it yet) according to local time, preserving order.
          undropped: function (sets) {
            return sets.filter(
              (set) => (Date.parse(set.exitDate.exact) || Infinity) > this.now
            );
          },

          // unreleased returns the sets in the given array that have not been released yet according to local time,
          // preserving order.
          unreleased: function (sets) {
            return sets.filter(
              (set) => (Date.parse(set.enterDate.exact) || Infinity) > this.now
            );
          },
        },
        mounted() {
          this.hideAlert20230507 =
            localStorage.hideAlert20230507 === "1" ||
            this.now > Date.parse("2024-01-01T00:00:00Z");
        },
        watch: {
          hideAlert20230507(v) {
            // Local storage only stores strings.
            localStorage.hideAlert20230507 = v ? "1" : "0";
          },
        },
      }).mount("#vue");
    </script>
    <script src="/js/tracking.js"></script>

    <script>
      (function (i, s, o, g, r, a, m) {
        i["GoogleAnalyticsObject"] = r;
        (i[r] =
          i[r] ||
          function () {
            (i[r].q = i[r].q || []).push(arguments);
          }),
          (i[r].l = 1 * new Date());
        (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
      })(
        window,
        document,
        "script",
        "https://www.google-analytics.com/analytics.js",
        "ga"
      );
      ga("create", "UA-2876079-7", "auto");
      ga("require", "displayfeatures");
      ga("send", "pageview");
    </script>
  </body>
</html>
